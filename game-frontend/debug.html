<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Contract Debug</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #eee;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        .section {
            background: #16213e;
            border: 2px solid #0f3460;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        h1 { color: #e94560; }
        h2 { color: #0f3460; background: #e94560; padding: 10px; border-radius: 5px; }
        .good { color: #0ead69; font-weight: bold; }
        .bad { color: #e94560; font-weight: bold; }
        code {
            background: #0f3460;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin: 5px 0;
        }
        button {
            background: #e94560;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #c23550; }
        #output { white-space: pre-wrap; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîß Contract Address Debugger</h1>
    
    <div class="section">
        <h2>Current Configuration</h2>
        <div id="config">Loading...</div>
    </div>

    <div class="section">
        <h2>Actions</h2>
        <button onclick="checkContract()">üîç Check Contract</button>
        <button onclick="clearCache()">üóëÔ∏è Clear Cache & Reload</button>
        <button onclick="window.location.reload(true)">üîÑ Hard Refresh</button>
    </div>

    <div class="section">
        <h2>Results</h2>
        <div id="output">Click "Check Contract" to verify...</div>
    </div>

    <script type="module">
        import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.10.0/+esm";
        
        const CORRECT_ADDRESS = "0x4A679253410272dd5232B3Ff7cF5dbB88f295319";
        const OLD_ADDRESS = "0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9";
        
        // Check what app.js has
        fetch('app.js')
            .then(r => r.text())
            .then(code => {
                const match = code.match(/CONTRACT_ADDRESS = "(.+?)"/);
                const address = match ? match[1] : 'NOT FOUND';
                
                let html = `<p><strong>Contract in app.js:</strong> <code>${address}</code>`;
                
                if (address === CORRECT_ADDRESS) {
                    html += ` <span class="good">‚úÖ CORRECT</span>`;
                } else {
                    html += ` <span class="bad">‚ùå WRONG! Should be ${CORRECT_ADDRESS}</span>`;
                }
                
                html += `</p>`;
                html += `<p><strong>Correct Address:</strong> <code>${CORRECT_ADDRESS}</code></p>`;
                html += `<p><strong>Old Address:</strong> <code>${OLD_ADDRESS}</code></p>`;
                
                document.getElementById('config').innerHTML = html;
            });

        window.checkContract = async function() {
            const output = document.getElementById('output');
            output.innerHTML = 'Checking...\n\n';
            
            try {
                const provider = new ethers.BrowserProvider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                
                output.innerHTML += '‚úÖ MetaMask connected\n\n';
                
                // Check both addresses
                const correctCode = await provider.getCode(CORRECT_ADDRESS);
                const oldCode = await provider.getCode(OLD_ADDRESS);
                
                output.innerHTML += `Checking CORRECT address: ${CORRECT_ADDRESS}\n`;
                output.innerHTML += `Has contract: ${correctCode !== '0x' ? '‚úÖ YES' : '‚ùå NO'}\n\n`;
                
                output.innerHTML += `Checking OLD address: ${OLD_ADDRESS}\n`;
                output.innerHTML += `Has contract: ${oldCode !== '0x' ? '‚úÖ YES' : '‚ùå NO'}\n\n`;
                
                if (correctCode === '0x') {
                    output.innerHTML += '‚ùå PROBLEM: Correct contract not deployed!\n';
                    output.innerHTML += 'Need to run: npx hardhat run scripts/deploy.js --network localhost\n\n';
                } else {
                    output.innerHTML += '‚úÖ Contract is deployed correctly!\n\n';
                    
                    // Try to check round 779
                    const ABI = ["function roundPlayers(uint256) view returns (address[])"];
                    const contract = new ethers.Contract(CORRECT_ADDRESS, ABI, provider);
                    
                    try {
                        const players = await contract.roundPlayers(779);
                        output.innerHTML += `Round 779 has ${players.length} bets\n`;
                        if (players.length === 0) {
                            output.innerHTML += '\n‚ùå YOUR BET IS NOT ON THE BLOCKCHAIN!\n';
                            output.innerHTML += 'Your browser was using the old cached contract address.\n';
                            output.innerHTML += 'Clear cache and reload to fix.\n';
                        }
                    } catch (e) {
                        output.innerHTML += '‚ùå Round 779 does not exist on blockchain\n';
                        output.innerHTML += '\nYour bet was sent to wrong/old contract address!\n';
                    }
                }
                
            } catch (error) {
                output.innerHTML += `\n‚ùå Error: ${error.message}\n`;
            }
        };
        
        window.clearCache = function() {
            localStorage.clear();
            sessionStorage.clear();
            alert('Cache cleared! Page will reload...');
            window.location.reload(true);
        };
    </script>
</body>
</html>
