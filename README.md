# Ultimate Color Prediction Game (Blockchain + Supabase)

## âš ï¸ TESTNET ONLY - DO NOT USE WITH REAL MONEY

This is a demonstration project. Never deploy to mainnet without:
- âœ… Professional security audit
- âœ… Provably fair randomness (Chainlink VRF)
- âœ… Emergency pause mechanisms
- âœ… Comprehensive testing

---

## ğŸ® What is This?

A professional betting game where users bet ETH on colors (RED, GREEN, or VIOLET).

**Key Features:**
- **Blockchain**: Holds funds & pays winners instantly (Trustless Payouts)
- **Backend**: Auto-resolves rounds every 30 seconds
- **Supabase**: Real-time betting history & smooth UI data

---

## ğŸ“‹ Prerequisites

- [Node.js](https://nodejs.org/) v16+ installed
- [MetaMask](https://metamask.io/) browser extension
- No prior blockchain experience needed!

---

## ğŸš€ Installation & Quick Start

Everything is automated. You don't need complex commands.

### 1. Download Project
Clone this repository or download the ZIP.

```bash
git clone <your-repo-url>
cd color-prediction-game
```

### 2. Install Dependencies (First time only)
Open a terminal in this folder and run:

```bash
npm install
cd game-backend && npm install
cd ..
```

### 3. Start Everything
Double-click **`START_ALL.bat`** in this folder.

This will automatically:
- âœ… Start the Hardhat Blockchain (Local Ethereum network)
- âœ… Deploy the Smart Contract
- âœ… Fund the contract with 5,000 ETH
- âœ… Start the Game Backend engine

**Keep all terminal windows open while playing!**

### 4. Play the Game
Open `game-frontend/index.html` in your browser.

### 5. Connect Your Wallet

1. **Add Localhost Network to MetaMask:**
   - Network Name: `Localhost 8545`
   - RPC URL: `http://127.0.0.1:8545`
   - Chain ID: `31337`
   - Currency Symbol: `ETH`

2. **Import a Test Account:**
   - Look at the **"Hardhat Blockchain"** terminal window
   - Find `Account #0: 0x...`
   - Copy the **Private Key** below it (NOT the address)
   - Open MetaMask â†’ Click your account circle â†’ **Import Account** â†’ Paste Private Key
   - ğŸ‰ You'll have **10,000 test ETH** to play with!

3. **Betting Limits:**
   - Minimum: 0.01 ETH
   - Maximum: 100 ETH per bet (Safe mode)

---

## ğŸ“¸ Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User/     â”‚  Bets    â”‚  Smart Contract  â”‚  Pays    â”‚   Winner's   â”‚
â”‚  Frontend   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   (The House)    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚    Wallet    â”‚
â”‚             â”‚   ETH    â”‚                  â”‚   ETH    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚
       â”‚ Views History            â”‚ Resolves Round
       â”‚                          â”‚
       â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Game Backend    â”‚
â”‚     DB      â”‚  Updates â”‚   (The Brain)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Stats   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

*(Add screenshots of your game UI in the `docs/` folder)*

---

## ğŸ² How It Works (Simple Terms)

### 1. You Place a Bet
- You select **RED (2x)**, **GREEN (2x)**, or **VIOLET (5x)**
- Your ETH goes directly into the **Smart Contract**
- The contract locks your money safely on the blockchain

### 2. The Round Ends
- The **Game Backend** watches the clock (30 seconds per round)
- When time is up, it generates a result (Red/Green/Violet)

### 3. You Get Paid
- The Backend commands the Smart Contract to `resolveRound()`
- The Contract checks all bets and determines winners
- **If you won:** The Contract INSTANTLY sends ETH to your wallet
- **If you lost:** The ETH stays in the house pool

---

## ğŸ” Result Generation Transparency

**Current Implementation:**
- Results are generated by the backend using JavaScript's `Math.random()`
- âš ï¸ **NOT cryptographically secure**
- Users must trust that the backend operator is honest

**Future Improvement:**
- Integrate [Chainlink VRF](https://chain.link/vrf) for **provably fair randomness**
- This would allow anyone to verify that results weren't manipulated

---

## ğŸ› ï¸ Tech Stack

| Component | Technology |
|-----------|-----------|
| **Smart Contracts** | Solidity, Hardhat |
| **Blockchain** | Ethereum (Local: Hardhat Network) |
| **Frontend** | HTML, CSS, JavaScript, ethers.js |
| **Backend** | Node.js, Express |
| **Database** | Supabase (PostgreSQL) |
| **Wallet** | MetaMask |

---

## ğŸ“‚ Project Structure

```
color-prediction-game/
â”‚
â”œâ”€â”€ contracts/
â”‚   â””â”€â”€ ColorPrediction.sol      # Smart Contract (The "Bank")
â”‚                                 # - placeBet(): Accept user bets
â”‚                                 # - resolveRound(): Pay winners
â”‚                                 # - Only owner (backend) can resolve
â”‚
â”œâ”€â”€ game-frontend/               # The Website (UI)
â”‚   â”œâ”€â”€ index.html              # Main game interface
â”‚   â”œâ”€â”€ style.css               # Styling
â”‚   â””â”€â”€ app.js                  # Connects to Blockchain & Supabase
â”‚
â”œâ”€â”€ game-backend/                # The Brain (Game Loop)
â”‚   â”œâ”€â”€ index.js                # - Starts/ends rounds (30s timer)
â”‚   â”œâ”€â”€ .env                    # - Tells blockchain who won
â”‚   â””â”€â”€ package.json            # - Updates Supabase with history
â”‚
â”œâ”€â”€ scripts/                     # Helper Tools
â”‚   â”œâ”€â”€ deploy.js               # Deploys contract to blockchain
â”‚   â””â”€â”€ fundContract.js         # Gives contract 5,000 ETH for payouts
â”‚
â”œâ”€â”€ START_ALL.bat               # One-click launcher
â”œâ”€â”€ .env                        # Configuration (RPC URLs, etc.)
â””â”€â”€ README.md                   # You are here!
```

---

## ğŸ›¡ï¸ Security Considerations

### âš ï¸ This is an educational project with known limitations:

| Issue | Description | Production Solution |
|-------|-------------|---------------------|
| **Centralized Randomness** | Backend controls results | Use Chainlink VRF |
| **No Fairness Proof** | Results can't be verified | Implement commit-reveal scheme |
| **Single Point of Failure** | Backend crash = frozen rounds | Use Chainlink Keepers |
| **UI-only Bet Limit** | Can be bypassed via contract | Enforce in smart contract |
| **Owner Control** | Only backend can resolve | Multi-signature controls |

### For Production Deployment:
1. âœ… Professional security audit (e.g., OpenZeppelin, Trail of Bits)
2. âœ… Chainlink VRF for verifiable randomness
3. âœ… Emergency pause mechanism in contract
4. âœ… Time-based auto-resolution fallback
5. âœ… Comprehensive test coverage (>90%)
6. âœ… Legal consultation (gambling laws vary by jurisdiction)

---

## ğŸ”§ Troubleshooting

### Problem: "Transaction reverted" or Payout Issues

**Solution:**
1. âœ… Is `START_ALL.bat` running? (Keep all terminal windows open!)
2. âœ… Did you reset MetaMask?
   - MetaMask â†’ Settings â†’ Advanced â†’ **Clear Activity Tab Data**
   - Reconnect your wallet to the site

### Problem: "Contract has insufficient funds"

**Solution:**
Run this command to give the house more money:

```bash
npx hardhat run scripts/fundContract.js --network localhost
```

### Problem: Rounds Not Progressing

**Solution:**
1. Check the **Game Backend** terminal for errors
2. Restart `START_ALL.bat`
3. Ensure `.env` file exists in `game-backend/`

### Problem: Can't Connect to Localhost

**Solution:**
- Verify MetaMask is on `Localhost 8545` network
- Check that Hardhat blockchain terminal shows "Started HTTP and WebSocket JSON-RPC server"

---

## âš™ï¸ Configuration

### Changing Round Duration

Edit `game-backend/.env`:

```env
ROUND_DURATION=30  # Change to 60 for 1-minute rounds
```

### Changing Contract Settings

Edit `contracts/ColorPrediction.sol` and redeploy:

```solidity
uint256 public constant MAX_BET = 100 ether;  // Change bet limit
```

Then redeploy:
```bash
npx hardhat run scripts/deploy.js --network localhost
```

---

## â“ Frequently Asked Questions

### Q: Is this real money?
**A:** No! This uses Hardhat's local blockchain with **fake test ETH**. It resets every time you restart.

### Q: Can I lose my bet?
**A:** Yes, like any betting game. Only bet what you can afford to lose (even fake money ğŸ˜„).

### Q: How do I know the game is fair?
**A:** Currently, you must **trust the backend operator**. See [Security Considerations](#-security-considerations) for limitations. In production, use Chainlink VRF for provable fairness.

### Q: Can I deploy this to real Ethereum (mainnet)?
**A:** **Technically yes**, but **DO NOT** without:
- Professional security audit
- Legal consultation (gambling laws)
- Chainlink VRF integration
- Emergency pause mechanisms
- Insurance fund for payouts

### Q: What happens if two people bet on the same color?
**A:** The contract pays **both** winners! That's why the house needs a large balance.

### Q: Can the house run out of money?
**A:** Yes! If winners drain the contract, payouts will fail. Monitor the contract balance and use `fundContract.js` to add more ETH.

### Q: Why does MetaMask show "unknown network"?
**A:** The local blockchain resets when you restart. Reset MetaMask's activity data (see Troubleshooting).

---

## ğŸ§ª For Developers: Running Tests

```bash
# Run smart contract tests
npx hardhat test

# Run with gas reporting
REPORT_GAS=true npx hardhat test

# Run backend tests (if implemented)
cd game-backend
npm test
```

---

## ğŸ“ TODO / Future Improvements

- [ ] Integrate Chainlink VRF for provably fair randomness
- [ ] Add emergency pause mechanism
- [ ] Implement time-based auto-resolution fallback
- [ ] Add comprehensive unit tests (>90% coverage)
- [ ] Create mobile-responsive UI
- [ ] Add user statistics dashboard
- [ ] Implement referral system
- [ ] Add sound effects and animations
- [ ] Support multiple blockchains (Polygon, BSC)
- [ ] Add leaderboard with top winners

---

## ğŸ¤ Contributing

This is an educational project. Contributions are welcome!

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

---

## ğŸ“œ License & Disclaimer

### License
This project is licensed under the **MIT License** - see the [LICENSE](LICENSE) file for details.

### Disclaimer
âš ï¸ **This project is for EDUCATIONAL PURPOSES ONLY.**

- Gambling may be **illegal in your jurisdiction**
- This is a **demonstration** of blockchain technology
- The developers assume **NO LIABILITY** for:
  - Financial losses
  - Legal issues
  - Security breaches
  - Misuse of this software

**Use at your own risk.**

---

## ğŸ“ Support

If you encounter issues:

1. Check the [Troubleshooting](#-troubleshooting) section
2. Review [FAQ](#-frequently-asked-questions)
3. Open an issue on GitHub with:
   - Error messages from terminal
   - Steps to reproduce
   - Screenshots (if applicable)

---

## ğŸ™ Acknowledgments

- [Hardhat](https://hardhat.org/) - Ethereum development environment
- [Supabase](https://supabase.com/) - Open-source Firebase alternative
- [MetaMask](https://metamask.io/) - Crypto wallet
- [ethers.js](https://docs.ethers.org/) - Ethereum library

---

## ğŸŒŸ Star This Project

If you found this helpful, please give it a â­ï¸ on GitHub!

---

**Built with â¤ï¸ for the blockchain community**